#!/bin/env python

import sys, os
import matplotlib
import matplotlib.pyplot as plt
import numpy as np

matplotlib.use('Agg')

fnames='sample/SM07279/depth.txt, sample/SM04710/depth.txt, sample/SM63089/depth.txt, sample/SM18469/depth.txt, sample/SM64466/depth.txt, sample/SM78901/depth.txt, sample/SM88283/depth.txt, sample/SM91580/depth.txt, sample/SM19841/depth.txt, sample/SM53889/depth.txt, sample/SM04612/depth.txt, sample/SM80187/depth.txt, sample/SM50684/depth.txt, sample/SM60147/depth.txt, sample/SM06165/depth.txt, sample/SM61721/depth.txt, sample/SM02652/depth.txt, sample/SM04256/depth.txt, sample/SM82571/depth.txt, sample/SM42456/depth.txt, sample/SM13801/depth.txt, sample/SM25556/depth.txt, sample/SM50255/depth.txt, sample/SM64268/depth.txt, sample/SM07886/depth.txt, sample/SM79970/depth.txt, sample/SM91858/depth.txt, sample/SM80522/depth.txt, sample/SM82879/depth.txt, sample/SM44285/depth.txt, sample/SM89461/depth.txt, sample/SM93536/depth.txt, sample/SM81532/depth.txt, sample/SM16661/depth.txt, sample/SM50810/depth.txt, sample/SM38510/depth.txt, sample/SM68028/depth.txt, sample/SM24790/depth.txt, sample/SM05005/depth.txt, sample/SM58272/depth.txt, sample/SM48704/depth.txt, sample/SM99172/depth.txt, sample/SM59700/depth.txt, sample/SM46735/depth.txt, sample/SM82840/depth.txt, sample/SM05852/depth.txt, sample/SM05241/depth.txt, sample/SM63723/depth.txt, sample/SM03494/depth.txt, sample/SM68166/depth.txt, sample/SM87361/depth.txt, sample/SM30102/depth.txt, sample/SM12253/depth.txt, sample/SM82239/depth.txt, sample/SM66468/depth.txt, sample/SM40018/depth.txt, sample/SM14870/depth.txt, sample/SM55833/depth.txt, sample/SM74189/depth.txt, sample/SM55320/depth.txt, sample/SM13732/depth.txt, sample/SM54479/depth.txt, sample/SM08248/depth.txt, sample/SM54417/depth.txt, sample/SM20468/depth.txt, sample/SM96244/depth.txt, sample/SM58553/depth.txt, sample/SM56504/depth.txt, sample/SM89971/depth.txt, sample/SM03950/depth.txt, sample/SM65094/depth.txt, sample/SM42533/depth.txt, sample/SM10295/depth.txt, sample/SM46204/depth.txt, sample/SM09219/depth.txt, sample/SM47089/depth.txt, sample/SM90673/depth.txt, sample/SM03851/depth.txt, sample/SM45598/depth.txt, sample/SM23319/depth.txt, sample/SM01307/depth.txt, sample/SM47947/depth.txt, sample/SM09243/depth.txt, sample/SM78197/depth.txt, sample/SM27261/depth.txt, sample/SM00424/depth.txt, sample/SM26843/depth.txt, sample/SM98039/depth.txt, sample/SM00942/depth.txt, sample/SM38439/depth.txt, sample/SM90370/depth.txt, sample/SM03231/depth.txt, sample/SM79279/depth.txt, sample/SM18598/depth.txt, sample/SM24510/depth.txt, sample/SM59513/depth.txt, sample/SM62482/depth.txt, sample/SM45148/depth.txt, sample/SM92731/depth.txt, sample/SM17061/depth.txt, sample/SM03662/depth.txt, sample/SM27279/depth.txt, sample/SM43911/depth.txt, sample/SM62046/depth.txt, sample/SM38356/depth.txt, sample/SM72510/depth.txt, sample/SM83351/depth.txt, sample/SM42859/depth.txt, sample/SM77729/depth.txt, sample/SM10592/depth.txt, sample/SM13446/depth.txt, sample/SM20501/depth.txt, sample/SM49361/depth.txt, sample/SM19258/depth.txt, sample/SM29206/depth.txt, sample/SM41405/depth.txt, sample/SM66629/depth.txt, sample/SM31020/depth.txt, sample/SM98941/depth.txt, sample/SM24110/depth.txt, sample/SM48820/depth.txt, sample/SM55023/depth.txt, sample/SM86927/depth.txt, sample/SM17333/depth.txt, sample/SM78802/depth.txt, sample/SM02694/depth.txt, sample/SM10214/depth.txt, sample/SM92035/depth.txt, sample/SM09596/depth.txt, sample/SM55081/depth.txt, sample/SM39242/depth.txt, sample/SM72192/depth.txt, sample/SM97109/depth.txt, sample/SM18650/depth.txt, sample/SM77474/depth.txt, sample/SM39064/depth.txt, sample/SM83489/depth.txt, sample/SM46474/depth.txt, sample/SM32514/depth.txt, sample/SM58303/depth.txt, sample/SM82940/depth.txt, sample/SM83499/depth.txt, sample/SM69365/depth.txt, sample/SM07584/depth.txt, sample/SM53560/depth.txt, sample/SM01105/depth.txt, sample/SM54687/depth.txt, sample/SM57842/depth.txt, sample/SM26738/depth.txt, sample/SM48706/depth.txt, sample/SM11935/depth.txt, sample/SM24309/depth.txt, sample/SM14237/depth.txt, sample/SM14701/depth.txt, sample/SM73162/depth.txt, sample/SM79371/depth.txt, sample/SM92091/depth.txt, sample/SM58480/depth.txt, sample/SM52269/depth.txt, sample/SM55274/depth.txt, sample/SM56586/depth.txt, sample/SM22904/depth.txt, sample/SM59435/depth.txt, sample/SM44616/depth.txt, sample/SM68597/depth.txt, sample/SM46579/depth.txt, sample/SM60613/depth.txt, sample/SM82775/depth.txt, sample/SM63346/depth.txt, sample/SM98964/depth.txt, sample/SM26692/depth.txt, sample/SM00242/depth.txt, sample/SM91619/depth.txt, sample/SM58863/depth.txt, sample/SM01020/depth.txt, sample/SM28670/depth.txt, sample/SM39133/depth.txt, sample/SM82434/depth.txt, sample/SM39474/depth.txt, sample/SM71462/depth.txt, sample/SM55602/depth.txt, sample/SM92576/depth.txt, sample/SM98482/depth.txt, sample/SM12132/depth.txt, sample/SM88891/depth.txt, sample/SM65232/depth.txt, sample/SM71270/depth.txt, sample/SM99877/depth.txt, sample/SM53125/depth.txt, sample/SM82847/depth.txt, sample/SM02834/depth.txt, sample/SM15838/depth.txt, sample/SM87621/depth.txt, sample/SM05315/depth.txt, sample/SM00034/depth.txt, sample/SM52223/depth.txt, sample/SM68958/depth.txt, sample/SM76234/depth.txt, sample/SM58273/depth.txt, sample/SM13374/depth.txt, sample/SM97852/depth.txt, sample/SM46377/depth.txt, sample/SM37146/depth.txt, sample/SM98989/depth.txt, sample/SM78042/depth.txt, sample/SM11176/depth.txt, sample/SM04647/depth.txt, sample/SM34405/depth.txt, sample/SM40057/depth.txt, sample/SM69946/depth.txt, sample/SM15491/depth.txt, sample/SM69493/depth.txt, sample/SM32644/depth.txt, sample/SM08926/depth.txt, sample/SM54373/depth.txt, sample/SM37971/depth.txt, sample/SM68136/depth.txt, sample/SM17619/depth.txt, sample/SM75233/depth.txt, sample/SM69649/depth.txt, sample/SM13803/depth.txt, sample/SM53845/depth.txt, sample/SM97181/depth.txt, sample/SM36519/depth.txt, sample/SM38307/depth.txt, sample/SM48734/depth.txt, sample/SM74480/depth.txt, sample/SM82420/depth.txt, sample/SM20588/depth.txt, sample/SM16161/depth.txt, sample/SM91362/depth.txt, sample/SM49995/depth.txt, sample/SM52589/depth.txt, sample/SM77472/depth.txt, sample/SM18289/depth.txt, sample/SM73350/depth.txt, sample/SM87590/depth.txt, sample/SM46408/depth.txt, sample/SM82853/depth.txt, sample/SM61954/depth.txt, sample/SM28576/depth.txt, sample/SM62485/depth.txt, sample/SM64076/depth.txt, sample/SM64582/depth.txt, sample/SM85467/depth.txt, sample/SM07894/depth.txt, sample/SM39346/depth.txt, sample/SM18719/depth.txt, sample/SM97677/depth.txt, sample/SM06869/depth.txt, sample/SM81415/depth.txt, sample/SM28275/depth.txt, sample/SM46584/depth.txt, sample/SM61805/depth.txt, sample/SM51245/depth.txt, sample/SM69053/depth.txt, sample/SM08711/depth.txt, sample/SM90033/depth.txt, sample/SM89955/depth.txt, sample/SM97250/depth.txt, sample/SM87689/depth.txt, sample/SM00842/depth.txt, sample/SM47354/depth.txt, sample/SM05398/depth.txt, sample/SM81380/depth.txt, sample/SM00491/depth.txt, sample/SM35433/depth.txt, sample/SM95303/depth.txt, sample/SM29713/depth.txt, sample/SM18440/depth.txt, sample/SM25062/depth.txt, sample/SM13823/depth.txt, sample/SM56888/depth.txt, sample/SM93893/depth.txt, sample/SM43280/depth.txt, sample/SM50349/depth.txt, sample/SM43345/depth.txt, sample/SM55275/depth.txt, sample/SM84936/depth.txt, sample/SM19402/depth.txt, sample/SM58628/depth.txt, sample/SM92908/depth.txt, sample/SM68703/depth.txt, sample/SM41429/depth.txt, sample/SM16938/depth.txt, sample/SM24488/depth.txt, sample/SM58213/depth.txt, sample/SM45767/depth.txt, sample/SM56006/depth.txt, sample/SM64482/depth.txt, sample/SM51058/depth.txt, sample/SM25716/depth.txt, sample/SM57577/depth.txt, sample/SM26774/depth.txt, sample/SM50902/depth.txt, sample/SM04362/depth.txt, sample/SM30675/depth.txt, sample/SM24479/depth.txt, sample/SM47660/depth.txt, sample/SM07470/depth.txt'.split(', ')

fin = []
title, fout = sys.argv[1:3]
fin = sys.argv[3:]
#title, fout, fin, = 'Sample Summary Plot', 'coverage.png', fnames

if type(fin) == str:
    fin = [fin]

data = [np.loadtxt(f, delimiter="\t", dtype=str)[:,-1].astype(int) 
        for f in fin]

coverage = np.array([[100*sum(x[x > k])/sum(x) 
                      for k in range(1,41)] for x in data])

summary = np.mean(coverage, axis=0)

plt.plot(coverage.transpose(), color='b')
if coverage.shape[0] > 1:
    plt.plot(summary, 'r')
plt.grid(1)
plt.xticks(list(range(0,45,5)), [str(x) + 'x' for x in range(0,45,5)])
plt.ylabel('coverage %')
plt.title(title)
plt.savefig(fout)
#plt.show()
